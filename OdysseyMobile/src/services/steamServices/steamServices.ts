import { Injectable } from '@angular/core';
import { Http, Headers, RequestOptions } from '@angular/http';

import 'rxjs/add/operator/map';

@Injectable()
export class SteamServices {

  public allowed: boolean = false;
  public allOwnedGamesText: string = '{"response":{"game_count":63,"games":[{"appid":57300,"name":"Amnesia: The Dark Descent","playtime_forever":11,"img_icon_url":"2c08de657a8b273eeb55bb5bf674605ca023e381","img_logo_url":"75b8a82acfb05abda97977ac4eb5af20e0dcf01e","has_community_visible_stats":true},{"appid":56400,"name":"Warhammer 40,000: Dawn of War II - Retribution","playtime_forever":113,"img_icon_url":"56241ad73fdc9a4d208d5417a0d9109e9a6e29cd","img_logo_url":"df63f6688e90e8874061e268556f88af2f712f5e","has_community_visible_stats":true},{"appid":34330,"name":"Total War: SHOGUN 2","playtime_forever":7176,"img_icon_url":"2fa97296a62daf0329b3867ad6837a2289229fbb","img_logo_url":"c6f6e87e742a2e40689486423e8320bd318e3ec7","has_community_visible_stats":true},{"appid":105600,"name":"Terraria","playtime_forever":22841,"img_icon_url":"858961e95fbf869f136e1770d586e0caefd4cfac","img_logo_url":"783399da7d865b7b5b1560891b1e9463345e8fa9","has_community_visible_stats":true},{"appid":72850,"name":"The Elder Scrolls V: Skyrim","playtime_forever":35818,"img_icon_url":"b9aca8a189abd8d6aaf09047dbb0f57582683e1c","img_logo_url":"c5af3cde13610fca25cd17634a96d72487d21e74","has_community_visible_stats":true},{"appid":108710,"name":"Alan Wake","playtime_forever":396,"img_icon_url":"ec7953511aaaf5a2c2093b872b5b43c6cab56462","img_logo_url":"0f9b6613ac50bf42639ed6a2e16e9b78e846ef0a","has_community_visible_stats":true},{"appid":7670,"name":"BioShock","playtime_forever":0,"img_icon_url":"9a7c9f640a76e6a32592277dbbc36a0f6da05372","img_logo_url":"4c2a7f97e6556a95319eb346aed7beff9fe0535c","has_community_visible_stats":true},{"appid":409710,"name":"BioShock Remastered","playtime_forever":808,"img_icon_url":"eb72262cd3ccc3219dd76392be3b60a4b6cbfd38","img_logo_url":"cb7318b68128f6aa90c9e4e2d14544281ac22da0","has_community_visible_stats":true},{"appid":209080,"name":"Guns of Icarus Online","playtime_forever":283,"img_icon_url":"968e8c0b7a55f0229392278123dfd486140c9421","img_logo_url":"925b7c2a6b698144622bed4bd2d0086114df2fa9","has_community_visible_stats":true},{"appid":223470,"name":"POSTAL 2","playtime_forever":5,"img_icon_url":"9f491f765476222da4ef508a5dd38db4787da5b8","img_logo_url":"ec19963d4431918601eee5198bafcd021259136d","has_community_visible_stats":true},{"appid":109600,"name":"Neverwinter","playtime_forever":343,"img_icon_url":"b65eee286148b9ab29c27847ff47cbcd158788b6","img_logo_url":"ed70d948a976638f8052ed5d8c9c28c92b975e7b","has_community_visible_stats":true},{"appid":218230,"name":"PlanetSide 2","playtime_forever":6711,"img_icon_url":"f09d788b57eccd48ad9a6d1ec0dbf0707db39612","img_logo_url":"8bb9796bf871a1d620b28db4dfb2abef2138542d","has_community_visible_stats":true},{"appid":230410,"name":"Warframe","playtime_forever":994,"img_icon_url":"bcf887d7b0707e5418e1680de92e85ca899516ac","img_logo_url":"3785f3576cdef5cf20a8b815bdf867154ccbe7d5","has_community_visible_stats":true},{"appid":236390,"name":"War Thunder","playtime_forever":858,"img_icon_url":"88259dcb7014dcdb109d9ece0cfc70c100bc2f9c","img_logo_url":"0c6a14f66f95baf08da8199142b09b51d3cd6273","has_community_visible_stats":true},{"appid":238960,"name":"Path of Exile","playtime_forever":625,"img_icon_url":"1110764aac57ac28d7ffd8c43071c75d5482a9c9","img_logo_url":"a71bd4fa0b3f84292c5e4d026e0f2acb6bc6c268","has_community_visible_stats":true},{"appid":243870,"name":"Tom Clancy\'s Ghost Recon Phantoms - NA","playtime_forever":9120,"img_icon_url":"7ca714724bfc22fc9601d8b65f65c47f5d4103f3","img_logo_url":"e6d16e51104bc385e99ff6b14f5fb016c813590d"},{"appid":209870,"name":"Blacklight: Retribution","playtime_forever":247,"img_icon_url":"de0e0786f3473b277fbbf7db4f3fdc5ea07b942c","img_logo_url":"6c9cd35124a99938537fa7b99508ed8ae5e26d80","has_community_visible_stats":true},{"appid":248570,"name":"Toribash","playtime_forever":1,"img_icon_url":"7642e8aaf8d97a5fca68d749ed5cdd548cbb6d35","img_logo_url":"a364e4ad7f1a9084d8d98a1997a0696967e70c50","has_community_visible_stats":true},{"appid":251670,"name":"Battle Nations","playtime_forever":5,"img_icon_url":"74a9948e9d573c5c61b8f78919fdd0cd82ba1f85","img_logo_url":"83e10b6e8e5ea56207497bd6b27fa9d424a2f85f","has_community_visible_stats":true},{"appid":253710,"name":"theHunter Classic","playtime_forever":0,"img_icon_url":"4a91dc770675e559038a4f46e0daa4f8fa42ee30","img_logo_url":"fbfd9daf55e8489e42500bd3e08ca8f4c5f028db","has_community_visible_stats":true},{"appid":107410,"name":"Arma 3","playtime_2weeks":463,"playtime_forever":1633,"img_icon_url":"3212af52faf994c558bd622cb0f360c1ef295a6b","img_logo_url":"b49962441a01f1f80b180af1293608dddf7df6b0","has_community_visible_stats":true},{"appid":252950,"name":"Rocket League","playtime_forever":7469,"img_icon_url":"9ad6dd3d173523354385955b5fb2af87639c4163","img_logo_url":"3854e40582bc14b8ba3c9ee163a0fa64bc538def","has_community_visible_stats":true},{"appid":211820,"name":"Starbound","playtime_forever":10938,"img_icon_url":"4dbf4041c33eb2edfc41f552320a2e584519134c","img_logo_url":"38652d0a34354f77e37073aeb5e8e9619d2c5308","has_community_visible_stats":true},{"appid":367540,"name":"Starbound - Unstable","playtime_forever":0,"img_icon_url":"9420b506fe5b00fd02d9005f1f5555358e3f71f7","img_logo_url":"53eb828591fb86c72358b7939dde633ba3e5c6c7","has_community_visible_stats":true},{"appid":285900,"name":"Gang Beasts","playtime_forever":2215,"img_icon_url":"fe0f0440dabf5ff8d8326d2d6ff629e016fe3559","img_logo_url":"75fa11f4955cef767e5aa257ebac150eb5fd5208","has_community_visible_stats":true},{"appid":293260,"name":"Card Hunter","playtime_forever":6,"img_icon_url":"f38aa5d47161b46d85f024ace6ba6da17b1f4e10","img_logo_url":"95a3ebbb2aedafd8266a6a13c4611f998b136d93","has_community_visible_stats":true},{"appid":301520,"name":"Robocraft","playtime_forever":964,"img_icon_url":"25b4f8bc206a7768638974d991b12d3943729d49","img_logo_url":"6bcd914a790af2f2eeb91ea5d23482c15c68fb0a","has_community_visible_stats":true},{"appid":302830,"name":"BLOCKADE 3D","playtime_forever":1,"img_icon_url":"74d405059efcdb1b98f692a991dad72a656a6bfb","img_logo_url":"065fe210dbd6c50ba477b072c2465cfdf74cc79d","has_community_visible_stats":true},{"appid":304050,"name":"Trove","playtime_forever":77,"img_icon_url":"76b62601bb6f0551c415697fe92a6653340f4a5e","img_logo_url":"af5b68335bcb09e5fdd40b5e25fa6475ed75f263","has_community_visible_stats":true},{"appid":304430,"name":"INSIDE","playtime_forever":907,"img_icon_url":"047e00c80d6aca008ce5eaaf54df4d98c822ee19","img_logo_url":"330a1902986716b0ab8947c8571687403bb99d6e","has_community_visible_stats":true},{"appid":224600,"name":"Defiance","playtime_forever":59,"img_icon_url":"d288f803179f2a5925a096e0be8495c36b522d6f","img_logo_url":"0b9d1e2e5f2a0a21773d1625b1e2b37bae30bc21","has_community_visible_stats":true},{"appid":227700,"name":"Firefall","playtime_forever":78,"img_icon_url":"9b00a74fea9759c7559e7e20a81b4f25bd0a61b4","img_logo_url":"89c55efb73b88472ae69315dc691353955edcd98","has_community_visible_stats":true},{"appid":310370,"name":"The Way of Life Free Edition","playtime_forever":8,"img_icon_url":"a3550ff71b3b455f35fb43e28e6b220e2473bf3a","img_logo_url":"341c7c6e81e8ffc29cd563b6b1aa4d4c657a0516","has_community_visible_stats":true},{"appid":291480,"name":"Warface","playtime_forever":35,"img_icon_url":"fb8ff6e843ac7020086431da50a8b0a5d31c7bcc","img_logo_url":"3e7109f2f82da9c498806d962601c4b40dbc6bd8","has_community_visible_stats":true},{"appid":227940,"name":"Heroes & Generals","playtime_forever":0,"img_icon_url":"dc7d500149f0281a62d9064aafce8d50f1685b5a","img_logo_url":"0700b3fd0b939bd2c058b5a47bf044d2e9fcfff9","has_community_visible_stats":true},{"appid":323850,"name":"Move or Die","playtime_forever":353,"img_icon_url":"3998d6f23592638da8d080825cc5da2e6cd4ffa3","img_logo_url":"7be18e94e60c03d674852ac952d4aad8d12b787a","has_community_visible_stats":true},{"appid":730,"name":"Counter-Strike: Global Offensive","playtime_forever":424,"img_icon_url":"69f7ebe2735c366c65c0b33dae00e12dc40edbe4","img_logo_url":"d0595ff02f5c79fd19b06f4d6165c3fda2372820","has_community_visible_stats":true},{"appid":335150,"name":"Magic Barrage - Bitferno","playtime_forever":1,"img_icon_url":"446ef2ccdd60ebecb1da6dd28c020081b68ee78c","img_logo_url":"9546e962e293d4f3cb0083e43b787da5da6681d1","has_community_visible_stats":true},{"appid":39120,"name":"RIFT","playtime_forever":0,"img_icon_url":"fcbeb7184880a9c333c00f11a000888575c3600e","img_logo_url":"3f922b0fac77fda104b2cc22692cb11c71aa549f","has_community_visible_stats":true},{"appid":8850,"name":"BioShock 2","playtime_forever":0,"img_icon_url":"f5eda925c0e57373aaea4cae17b6f175115a8d54","img_logo_url":"fde6fa1b15e4eb409c9d592197024571fded77e7","has_community_visible_stats":true},{"appid":409720,"name":"BioShock 2 Remastered","playtime_forever":0,"img_icon_url":"97527a02b36f8ac4aba21005c2d953cc908a08e1","img_logo_url":"34c3f591cf4cb28711d7f33f73dee0f09cdb94a4","has_community_visible_stats":true},{"appid":357330,"name":"Space Beast Terror Fright","playtime_forever":314,"img_icon_url":"ea1ef42275033cbb35215f6ee148696666097a81","img_logo_url":"ed46e6ac3123b3fe6714aa3ad31425291bbf656b","has_community_visible_stats":true},{"appid":365720,"name":"Skyrim Script Extender (SKSE)","playtime_forever":1,"img_icon_url":"48eaa1815ac4beddc4d7c9fec6c2517f6f0b718e","img_logo_url":"2e321af767f304de67d59f9c4329a8b8d553739b","has_community_visible_stats":true},{"appid":365670,"name":"Blender","playtime_forever":9518,"img_icon_url":"48733cd333eea6e40711a1b9c6dde32ffe363ced","img_logo_url":"5c4f9e482338e1ac7de6eb063d1a7dcf6df1e312","has_community_visible_stats":true},{"appid":444090,"name":"Paladins","playtime_forever":6519,"img_icon_url":"1565119c17f532338a0645b98e69e1fc1df0c29e","img_logo_url":"eeaf474bd305faa8c299d2df8e32278e10fc8c04","has_community_visible_stats":true},{"appid":596350,"name":"Paladins - Public Test","playtime_forever":0,"img_icon_url":"0a073dec4ffe8398b74369289d0c987134e35986","img_logo_url":"fa03dc049462669246e8ea8b0fffe6445fddd712","has_community_visible_stats":true},{"appid":310380,"name":"Fractured Space","playtime_forever":395,"img_icon_url":"ad6e742508e69c690d94136b3226de22edc42faa","img_logo_url":"6fb7ce7701d0715e440b723b092afac35fb79024","has_community_visible_stats":true},{"appid":477160,"name":"Human: Fall Flat","playtime_forever":284,"img_icon_url":"fbd4c6d6ac04408b9ea582f60dc1593e45ce69ab","img_logo_url":"45f1ec8149d34a6e72c9c498a401b649e281cade","has_community_visible_stats":true},{"appid":442080,"name":"Riders of Icarus","playtime_forever":0,"img_icon_url":"0d9bb7847fdf3485b375d0133998795a9749347d","img_logo_url":"2d6df14d2fa0358b2232f815af9716236939a842","has_community_visible_stats":true},{"appid":530700,"name":"Argo","playtime_forever":0,"img_icon_url":"b827f64552754338bd272d6d2095714d77fa15cb","img_logo_url":"065b70a44a0abdd53068358407cb873f1048ebaa","has_community_visible_stats":true},{"appid":534500,"name":"Tiger Knight: Empire War","playtime_forever":0,"img_icon_url":"569f892f5d0c70adbc59efd2e63b98bab5da3ec5","img_logo_url":"7fa28257a9eb026f2fd25b24b73304580532b7c6","has_community_visible_stats":true},{"appid":489830,"name":"The Elder Scrolls V: Skyrim Special Edition","playtime_forever":7,"img_icon_url":"0dfe3eed5658f9fbd8b62f8021038c0a4190f21d","img_logo_url":"356b389ad5e6937f097b21b23acbb89608878ecf","has_community_visible_stats":true},{"appid":555570,"name":"Infestation: The New Z","playtime_forever":1351,"img_icon_url":"b688a5ebdfbd4978d2fcd8118cb79649788ac4b5","img_logo_url":"7255e6535fe1597b487963f29d037c3b0d467e30","has_community_visible_stats":true},{"appid":578080,"name":"PLAYERUNKNOWN\'S BATTLEGROUNDS","playtime_forever":3888,"img_icon_url":"93d896e7d7a42ae35c1d77239430e1d90bc82cae","img_logo_url":"2d2732a33511b58c69aff6b098a22687a3bb8533","has_community_visible_stats":true},{"appid":582500,"name":"We Were Here","playtime_forever":115,"img_icon_url":"ea1cb7e566e7f67c554576f15e02c9e4c209ec39","img_logo_url":"72b49d58859a75850df4236bfd7460ba30cbebe1","has_community_visible_stats":true},{"appid":588430,"name":"Fallout Shelter","playtime_forever":1167,"img_icon_url":"bb39b682fefd9a95486911cd991d8cdc5d7b57c9","img_logo_url":"bdae0ecd14415771800d7be3f95aa29c7ec7cbc2","has_community_visible_stats":true},{"appid":608800,"name":"Guns of Icarus Alliance","playtime_forever":273,"img_icon_url":"d7f95f73cbed6458a74bcd4a7c0872fe332367ec","img_logo_url":"198aadc4cd79c1883e0f813973cfb335337c7f62","has_community_visible_stats":true},{"appid":674940,"name":"Stick Fight: The Game","playtime_forever":132,"img_icon_url":"28bc7ba8952d488e01e7136126cbbc3b42ee443a","img_logo_url":"f28c0524f32688b6b69fcbbcefb94ac7a95f18e4","has_community_visible_stats":true},{"appid":466240,"name":"Deceit","playtime_forever":74,"img_icon_url":"e8887d08926e8b6e76221f0077e05b8a64d54e52","img_logo_url":"d6fbc0126c00d030d3e82478b3acd2595a0cdc08","has_community_visible_stats":true},{"appid":203770,"name":"Crusader Kings II","playtime_forever":0,"img_icon_url":"56e9c15cbeb6c1f873f7f1dc757bae7618861484","img_logo_url":"a3170e4c1889a7e2a360feef61e07a5aee51dc88","has_community_visible_stats":true},{"appid":440900,"name":"Conan Exiles","playtime_forever":3488,"img_icon_url":"399859f8bdaeef066f14029d5f1910960545fbd9","img_logo_url":"c6984e1bcd8901a3e2bfab2c97c6ffd38a1ebc8a","has_community_visible_stats":true},{"appid":931180,"name":"Conan Exiles - Testlive Client","playtime_forever":0,"img_icon_url":"67a32c9bdd0738df619162c70bdebfe8a735abec","img_logo_url":"d27cbd7391566bcd59dfd4e6af6e49db12180789","has_community_visible_stats":true},{"appid":611500,"name":"Quake Champions","playtime_forever":0,"img_icon_url":"539032fb1e8b41d0a48ff11bf63bfe7918ace24c","img_logo_url":"fa02130ef0cc5d26eb96d5a5401e2550456da056","has_community_visible_stats":true}]}}';

  constructor(
    private http: Http
  ) {
    this.updateGameOwned('76561198057436359');
  }

  getGameInformationById(gameId : string) {
    const url = "https://store.steampowered.com/api/appdetails?appids=" + gameId;

    let headers = new Headers();
    headers.append('Access-Control-Allow-Origin' , '*');
    headers.append('Access-Control-Allow-Headers', "Origin, X-Requested-With, Content-Type, Accept");
    headers.append('Access-Control-Allow-Methods', 'POST, GET, OPTIONS, PUT');
    headers.append('Accept','application/json');
    headers.append('content-type','application/json');
    let options = new RequestOptions ({headers: headers});

    return this.http.get(url, options).toPromise().then( response => {
        console.log(response);
      }).catch(error => {
        console.log('An error occured while fetching the game(s) (' + name + ') from SteamAPI: \n' + error);
      });
  }

  updateGameOwned(userId : string) {
    if(userId === '76561198057436359'){
      this.allowed = true;
      console.log('Allowed');
    }else{
      this.allowed = false;
      console.log('Blocked');
    }
  }

  getSteamGamesOwned() : Object[] {
    if(this.allowed){
      return (JSON.parse(this.allOwnedGamesText)['response']['games']);
    }else{
      return [];
    }
  }
}
